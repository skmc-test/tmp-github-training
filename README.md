# GitHub ハンズオン用リポジトリ

git cloneからPull Requestまでをハンズオンで実施します。

どのような流れでコマンドを実行するかは、[Miro](https://miro.com/app/board/uXjVMhkGZbY=/?moveToWidget=3458764572778485104&cot=14)に記載しました。

VS Codeでの操作は、別リポジトリの[wiki](https://github.com/skmc-test/tmp-github-training/wiki)に記載してあります。

こちらも参考にしてください。

この説明だけでは、不明点や実施したいことができなこともあります。

（「コミットした内容をやっぱりやめたい」など）

そういった際は、質問してください。一緒に調べたりしてみましょう！

</br>

# ハンズオンの流れ

1. git clone < URL >
2. git branch <ブランチ名>
3. git checkout <ブランチ名>
    - git checkout -b <branch名>
4. ファイルの修正
5. git add < Folder or FIle >
    - gitignore
6. git commit -m "Comment"
7. git pull & git merge
8. git push
9. pull request

## その他のgit操作でよく使うコマンド

- git status

    git statusは、作業ディレクトリとステージングエリアの状態を表示するコマンドです。

    このコマンドを実行すると、下記がが表示されます。
    - どの変更がステージング済みで
    - どの変更がまだステージングされていないのか
    - どのファイルが Git の追跡対象外になっているのか

- git branch

    引数（オプション）なしで実行すると、既存ブランチが一覧表示されます。

    また、現在いるのブランチが緑色でハイライトされ、`*`でマークされます。
    
    `-r`オプションを指定すると、リモート追跡ブランチが一覧表示され、

    `-a`オプションを指定すると、ローカルとリモート両方のブランチが一覧表示されます。

---

## 1. git clone

`git clone https://github.com/skmc-test/tmp-github-training.git`

リモートリポジトリをの**現在の状態**をローカルリポジトリとして複製します。

これ以降の操作は、git pushを行うまですべてローカルリポジトリ内で実施されます。

リモートリポジトリへ修正は入らないため、自由に試すことが出来るとも言えます。

</br>

## 2. git branch

`git branch <ブランチ名>`

作業用のブランチを作成します。

ハンズオンでは、`従業員番号-お好きにどうぞ`

mainブランチは直接変更してはいけません。

mainブランチは常にビルドが可能でリリース可能な状態とするためです。

branch内では好きに変更・修正が出来ます。mainへの影響はありません。

branchは不要になったら削除も出来ます。やり直しもできるのです :)

</br>

## 3. git checkout

`git checkout <ブランチ名>`

ブランチの移動（切り替え）を行います。

現在、どのブランチで作業をしているかは`git branch`コマンドで*がついているブランチです。

こちらのコマンドも覚えておくとよいでしょう。

### git checkout -b <ブランチ名>

git branchでブランチを作成し、git checkoutでブランチへ移動という流れですが、この二つの動作を一回で実施できるコマンドが`git checkout -b`というオプションです。
このコマンドを実行するだけで、上記2と3の操作を一回で実行できます。

```
注意点：

TFSでは、checkoutはファイルを編集するためのロックを行っていました。
言葉が同じですが、TFSとは異なるためしっかりと覚えましょう。
``` 

</br>

## 4. ファイル修正

コミットを行うため、ファイルの修正を行います。

今回のハンズオンでは、フォルダ内に新規にtxtファイルを追加してもらいます。

ファイル名はなんでも大丈夫です。

</br>

## 5. git add

`git add <folder or file>`

gitではステージングとも呼ばれます。
コミットする対象を指定するコマンドです。

gitでは、コミットする対象を選択するという流れがあります。

もし、全ての変更をコミットしたい場合は、`git add .`としましょう。

カレントディレクトリ以下の全ての変更がコミット対象となります。

複数ファイルを変更していた際、「このファイルは次のコミットで実施したいなぁ」、「このフォルダは今のコミットには入れたくないな」と思うこともあるでしょう。

そういった際に細かくコミット対象を指定できます。

TFSでは「保留中の変更」の中からチェックインを行う対象ファイルにチェックをつける操作をやっていたと思います。

こちらの動作がgit addに相当します。

### .gitignoreファイル

ビルド成果物や中間ファイルなど、バイナリファイルはgit管理しません。

しかし、毎回git addでファイル指定も面倒くさい。。。

そんなときは、.gitignoreファイルを活用してみましょう。

この.gitignoreに記載したファイル、フォルダはgit管理から自動的に排除されるのです。

便利ですね :)

</br>

## 6. git commit

`git commit -m "コミットメッセージ"`

いよいよコミットです。

git commitは、**ローカルリポジトリ**に変更内容を登録する操作になります。

このコミットは、頻繁に行うことが推奨されています。

せめて1日の終わりにコミットするなどしておくと良いでしょう。

TFSでいう「チェックイン」に似ています。

ただし、ローカルリポジトリのみへの反映なので、他への影響はありません。

</br>

## 7. git pull & git merge

git pushでリモートリポジトリへ反映を行う前に、最新の状態を作業ブランチへ取り込みます。

下記のコマンドの流れで、リモートリポジトリの最新状態を作業しているブランチへマージします。

このマージの際、コンフリクトが起きていた場合は表示されますので、コンフリクトを解消しましょう。

```
1. git checkout main                   // mainブランチへ移動
2. git pull                            // リモートリポジトリの最新をローカルへ反映
3. git checkout <作業していたブランチ>  // 作業ブランチへ移動
4. git merge main                      // main -> 作業ブランチへマージ
```

### Q. なぜこれらを行うのか？

**A. cloneしてからの作業中にmainへ変更があった場合、それらを取り込みコンフリクトをあらかじめ解消するためです。**

pushやpull requestでも、コンフリクトが起きていた場合はマージを促されるます。

このため勝手に先祖返りすることはありませんが、常にローカルも最新にすることがお作法です。

</br>

## 8. git push

ローカルブランチで実行されたコミットをリモートリポジトリへPushします。

もしこの時、もしコンフリクトが発生している場合はエラーとなります。

コンフリクトが解消するように修正し、commit & pushを行いましょう。

ブランチで作業を行っている場合は、そのブランチへローカルリポジトリの内容が反映されます。

一番大事なmainへは影響がありません。大丈夫ですよー。

</br>

## 9. pull request

プルリクエストは、Gitの機能ではなく、**GitHub**が最初に提供した機能です。

プルリクエストは以下のような機能を提供します。

- 機能追加や改修など、作業内容をレビュー・マージ担当者やその他関係者に通知
- ソースコードの変更箇所をわかりやすく表示
- ソースコードに関するコミュニケーションの場を提供

ここからは、GitHubのWebページ上から操作を行います。

ブランチでプッシュが完了すると、GitHub上でプルリクエストが作成できます。

プルリクエスト作成時、自動でソースコードのマージチェックが行われます。

このとき、もしコンフリクトが発生している場合はエラーとなります。

コンフリクトの解消を先に行いましょう。

勝手にmainブランチへマージされることはないので安全です。

### プルリクエスト作成

1. GitHub上のリポジトリで`Compare & pull request`をクリックし、プルリクエストを作成します。

![](https://github.com/skmc-test/tmp-github-training/blob/pic/picture/pullreq1.png)

2. プルリクエスト作成画面が表示されます。Reviewer、Assigneesなどを設定します。

    プルリクエスト作成に当たり、コメントも追加できます。

    **特にReviewerは忘れがちです。レビューを行う際は注意してください。**

![](https://github.com/skmc-test/tmp-github-training/blob/pic/picture/pullreq2.png)

3. `Create pull request`をクリックします。

    プルリクエストが作成されます。

    お疲れ様でした！
  
    このプルリクエストの中でコメント等で確認を行ったり、Reviewerは確認を実施します。

4. Reviewerが承認後、Merge pull requestをクリックすると、変更がmainへマージされます。

![](https://github.com/skmc-test/tmp-github-training/blob/pic/picture/pullreq3.png)

5. 作成したブランチの開発が完了した場合は、`Delete branch`をクリックすることでブランチが削除されます。

引き続き、ブランチで開発を続ける場合は削除はしなくて大丈夫です。

</br>

### プルリクエスト承認

Reviewerに指定されたプルリクエストが作成されると、Reviewerのもとへメールが届きます。

対象のプルリクエストを開くと、`Add your review`というボタンが表示されています。

変更内容を確認し、`Review changes`ボタンから今後の対応を決定します。

- Commnet
- Approve
- Request changes

Approveとした場合は、レビュー完了です。

